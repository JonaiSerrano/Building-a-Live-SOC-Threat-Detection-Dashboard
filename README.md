# Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-

<h2>Description</h2>
This is a demonstration project showcasing live cyber attack tracking and visualization. It leverages IP addresses along with geolocation data (latitude and longitude) to identify and map the origin of unauthorized login attempts targeting a deliberately vulnerable machine. The system under observation is a Windows 10 Pro virtual machine hosted in the Azure Cloud. <br />


<h2>Languages and Utilities Used</h2>

- <b>PowerShell</b> 


<h2>Environments Used </h2>

- <b>Windows 10 Pro N</b> (22H2 x64 Gen2)
- <b>Azure</b>
- <b>Microsoft Sentinel</b>
- <b>API ipgeolocation.io</b>

<h2>Setup Walk Through</h2>

<p align="left">

Major steps on this project:

1. Set up an Azure Subscription (includes $200 in free credits for new users).
2. Deploy a Virtual Machine on Azure and intentionally disable both its network and Windows firewalls to simulate a vulnerable environment.
3. Configure a Log Analytics Workspace to collect and store logs generated by the virtual machine.
4. Enable Azure Sentinel (SIEM) to begin monitoring and analyzing security events
5. Use PowerShell scripting to extract logs from the VM and forward them to the Log Analytics Workspace. The script also sends log details to a geolocation API to retrieve latitude and longitude data, allowing real-time mapping of attack sources on a global visualization dashboard.
<hr>


<ins>Step 1:<ins> Creating a free Azure Account <br />


Visit: https://azure.microsoft.com/en-us/free/  all new users will be given $200 to perform this lab and many other projects inside Azure.


![Screenshot](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20134318.png)




















Subscription can be done either with the outlook or GitHub account. The form should be filled as per the requirement and there will be window showing No automatic charges and Azure will be asking for continuation of the service after the end of credit. 

![Screenshot](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20134650.png)












Once the sign up process gets complete, we will get directed to the dashboard of Azure.

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20134642.png)
<hr>





<ins>Step 2: Creation of <a href="https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/manage-resource-groups-portal">Resource Group</a>

To create the Resource Group, first visit the site: https://portal.azure.com/#home
Then, in the search bar type: Resource Group.

In Azure, a Resource Group is a logical grouping of resources that share the same lifespan. So everything we do in the lab will be under this unified group. It will make things easier to delete later.

  - *<ins>An Azure Resource Group is a logical container that holds and manages related cloud resources like virtual machines, databases, and storage so they can be deployed, monitored, and controlled as a unified unit.*

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20135618.png)















Once you find yourself in the resource group section, click on create.

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20190721.png?raw=true)

Make sure to choose the correct subscription. You should only have one at this point to choose from. From there you can name the group however you'd like.

*Ideally choose the same region for everything you create. Helps everything run smoother with lower latency.*

Select *Review + Create*. No need to change anything

<img width="1027" height="517" alt="image" src="https://github.com/user-attachments/assets/30978f26-9bdf-48d0-9e44-7eca0d1193f1" />

Here is what it should look like once created

<img width="2233" height="1069" alt="image" src="https://github.com/user-attachments/assets/0aff1f43-5d88-4314-bc0d-caa7c7296684" />
<br />
<hr>

<ins>Step 3: Creation of <a href="https://learn.microsoft.com/en-us/azure/virtual-network/virtual-networks-overview">Virtual Network</a>

</p>Since we are simulating a complete environment we need to create a Virtual Network as well.</p>
 <ul>
<li>Think of this as a subnet for a home or office network, like a router gateway to connect you to the Internet.</li>
<li>This will allow our VMs to plug into it just like a regular network.</li>
    </ul>

Type in Virtual Networks on the search bar and when prompted, select the <B>Create Virtual Network<B> button.

Next make sure the subscription stays the same and for the resource group choose the one you just created.

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20201515.png?raw=true)

After that you can skip the other sections and select *Review + Create*

<img width="161" height="46" alt="image" src="https://github.com/user-attachments/assets/0c7c4b31-6629-4798-ab84-e954fb2a4bbf" />
<hr>

<ins>Step 4: Creation of <a href="https://azure.microsoft.com/en-us/products/virtual-machines">Virtual Machine</a>

In the search bar, look up Virtual Machines or VM.
Select the Create tab.

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20204032.png?raw=true)


Choose the same resource group as before as well as Region. Name the VM however you'd like.

We will be using a Windows 10 Pro Image, as it is one of the most widely used operating systems and perfect for this project.

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20204248.png?raw=true)



Give a proper username and password. This username and password will be the login credential to this virtual machine later.
  - *Write this down somewhere to not forget*

For now, I am using username: CORP and Password as per the requirement of password policy. 

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20205237.png?raw=true)

In the Networking tab, be sure to choose the correct Virtual Network and Subnet. And select the "Delete public IP" option.

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20230322.png?raw=true)

Disable boot diagnostics in the monitoring tab

<img width="679" height="127" alt="image" src="https://github.com/user-attachments/assets/790466fe-2485-4d73-aa6e-22867759031e" />

The final step in the networking tab, we want the firewall to be the weakest and most open part of the network. That way attackers from around the world will try to break in, giving us plenty of data to study later.

In the NIC settings, there's an option to go with a more detailed setup. If we choose that and start fresh, we’ll see a basic set of rules for incoming traffic that we can adjust to fit our plan.
  - There we can see the default rule setup for the inbound traffic.
  - Remove that default inbound rule.

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20231619.png?raw=true)

Now we can create a new rule for the project.

In Destination port ranges, we put * to allow ALL ports. Protocol set to ANY to allow all the protocols. And lower the priority to 100.
Name this rule anything you want.

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20231955.png?raw=true)

After all this, we are in the clear!

Click *Review + Create*. FIRE UP THE MACHINE!!!

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20231625.png?raw=true)
<hr>










<ins>Step 5: <a href="https://learn.microsoft.com/en-us/azure/virtual-machines/windows/connect-rdp">Remote Login</a> to the virtual machine


Start by navigating to the search box inside Azure and open your virtual machine. Once it's launched, you'll find the Public IP address displayed on the right-hand side of the screen.




On your computer, click on the start menu> and go to Remote Desktop Connection

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20233656.png?raw=true)


Type in the public IP of the virtual machine created in azure. 



![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20233729.png?raw=true)




Remember the username and password that you created on the VM? Now it's time to put it to use.

Accept the certification pop-up, and the computer will establish a connection to the virtual machine.



![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20233740.png?raw=true)




Sucess! The Virtual Machine is running remotely through our desktop.
<hr>


<ins>Step 6:<ins> Monitoring Logs Remotely <br />

While logged in on your VM navigate to the *Event Viewer* by searching for it in the start menu.
Once it launches, navigate to *Windows Logs* and select the Security section. It may take a moment for all the security events to load under the "Number of events" tab. 
  - *Imagine that someone tried to access your desktop but didn’t succeed. Go back to the Security section and locate the event that corresponds to this failed login. You’ll be able to view detailed information about the attempt in the event report.*

Let’s simulate a failed login attempt by entering an incorrect password. This is going to generate a new event in the Security log that we can go back and look at!

To do that, we will once again open the remote desktop connection and enter the IP address of our virtual machine. And try to log in with FALSE credentials. 

  - We will refresh "security events" on the virtual machine and visualize the new failed login event.



![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20233729.png?raw=true)


Try logging in with incorrect credentials


![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20235202.png?raw=true)


Now let's go back to the VM & refresh the security events on the event viewer to see if this attempt is logged. 

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20235302.png?raw=true)


BAM!!! Here we can clearly see the audit failure. By clicking into it, we can get details of the IP address that attempted to access. 
  - We will use this information later in our lab.


![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-03%20235622.png?raw=true)

<hr>


<ins>Step 7:<ins> Making the VM intentionally less secure to monitor potential attack attempts. <br />

For this step, open the Start menu on the virtual machine and type <code>wf.msc</code> Click on Windows Defender Firewall Properties, then set the firewall state to Off.
  - *I know it feels weird, but this ensures we will be absolutely vulnerable to outside attacks!*
  - <b>Make sure to turn both private and public off.<b>

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20000345.png?raw=true)



![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20000351.png?raw=true)
<hr>


<ins>Step 8: Creating a<a href="https://learn.microsoft.com/en-us/azure/azure-monitor/logs/log-analytics-workspace-overview">Log Analytic Workspace</a>

On Azure's homepage, search for *Log Analytics Workspaces*
  - <b>*This is a tool that allows you to easily store, retain, and most importantly, query data collected from selected environments in Azure*<b>

Make sure to create it with the same resource group you have been using
  - Name it however you like

Press *Review + Create*

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20001516.png?raw=true)

<H4>!!! BEFORE CONTINUING, LET THE LOG ANALYTIC WORKSPACE FULLY DEPLOY!!! </H4>
<H4>!!! IF NOT, IT WON'T BE ABLE TO POPULATE TO SENTINEL!!! </H3>
<br />
<hr>


<ins>Step 9: Integrating Microsoft <a href="https://www.microsoft.com/en-us/security/business/siem-and-xdr/microsoft-sentinel">Sentinel</a>

On Azure's homepage, search for *Sentinel*
  - <b>*Microsoft Sentinel is a cloud-native SIEM and SOAR solution that uses AI, automation, and integrated threat intelligence to detect, investigate, and respond to security threats across your entire network*<b>

Select the *+ Create Microsoft Sentinel* button

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20003031.png?raw=true)

Choose your workplace and select the *Add* button on the bottom right to incorporate Sentinel into your Log Analytics Workspace.
  - This is allowing all the logs to be fed directly to Sentinel for us to access them through the SIEM.

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20002811.png?raw=true)

<br />
<hr>

<ins>Step 10: Connecting VMs, Log Analytics Workspace, and Sentinel to work together</a>

Access Sentinel and navigate to the *Content Management* drop-down on the left.
  - Select *Content Hub*

Search for "Windows Security Events" and install.
  - Make sure that ALL the individual sections install!

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20003729.png?raw=true)

Once it installs, we are going to add a solution. 

Click on the "Manage" button on the bottom right of the page.

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20004318.png?raw=true)

Once inside, click on "Windows Security Events via AMA"
  - *This connection enables you to view dashboards, create custom alerts, and improve investigation.*

Click "Open connector page"

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20004509.png?raw=true)

Select "Data Collection Rule"
  - Used by the VM to forward logs into the Log Analytics Workspace, which in turn lets us use it in our SIEM.

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20004856.png?raw=true)

Choose whatever rule name your heart desires.
  - *Make sure to choose the same Resource Group (Same old Same old)*

Select your VM
  - You might have to click "Azure subscription 1", then the name of your Resource group, and finally your VM

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20005212.png?raw=true)

On the "Collect" page you can leave it to collect "All Security Events"

Finally, *Review + Create*

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20010252.png?raw=true)

<br />
<hr>

<ins>Step 11: Viewing and Querying Logs</a>


Go to the search tab in the log workspace and click on "Logs" to view them. Then run a query based on your needs—for instance, to see failed login attempts

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20010541.png?raw=true)

We are given a KQL console where we can use scripts like the following to grab logs.

  - Examples
    - <code>SecurityEvent | where EventID == 4625. | project TimeGenerated, Account, Computer, EventID, IpAddress</code>
    - <code>let GeoIPDB_FULL = _GetWatchlist("geoip");
let WindowsEvents = SecurityEvent
    | where IpAddress == <attacker IP address>
    | where EventID == 4625
    | order by TimeGenerated desc
    | evaluate ipv4_lookup(GeoIPDB_FULL, IpAddress, network);
WindowsEvents</code>


![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20010909.png?raw=true)
<hr>

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20011230.png?raw=true)

<br />
<hr>

<ins>Step 12:<ins> Data Extraction and Mapping <br />

To map out and extract data, we need latitude, longitude, usernames, and IP's from the log details. Since all logs follow the same format, we can identify and retrieve this information using consistent data patterns.

Commence by opening up Sentinel and navigating to the "Configuration" drop-down and selecting *Watchlist*

From there, select Add New.

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20011617.png?raw=true)

Name it "geoip" as well as the alias "geoip"

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20011824.png?raw=true)

Then you need to upload a special .csv file 
  - This file contains over 55 thousand IP address locations.
  - This will allow us to map every attack that comes in on a map.

You can find the file in my Repository under the ".csv File" folder

Choose "network" as the SearchKey

Once again choose, *Review + Create*

![image](https://github.com/JonaiSerrano/Designing_Azure_Sentinel_SIEM-Live-Attack-Map-Monitoring-/blob/main/assets/Screenshot%202025-09-04%20012101.png?raw=true)


<h3>It will take about 10 minutes for all 55k lines to be read by Sentinel</h3>
<h3>Refresh till you see that there are 55K Watchlist items</h3>

To do that, 
expand one of the log, right click and choose extract data.

Or by running this query

    Failed_RDP_Geolocation_CL | parse RawData with * "latitude:" Latitude ",longitude:" Longitude ",destinationhost:" DestinationHost ",username:" Username ",sourcehost:" Sourcehost ",state:" State ", country:" Country ",label:" Label ",timestamp:" Timestamp | project Latitude,     Longitude, DestinationHost, Username, Sourcehost, State, Country, Label, Timestamp



![image](https://github.com/swopnilshakya7/Azure-Sentinel-SIEM-Mapping-Live-CyberAttacks/assets/140642619/5cc844f6-8fdf-45a4-86d2-0db53369fe20)










We can now wait for the attackers to attack in our system to get more data for the work.















<ins>Step 13:<ins> Setting up Map in Sentinel. <br />
We go to portal.azure.com
then Microsoft Sentinel and open the virtual machine here.
The dashboard of Sentinel gets open where we can see the overview of security events that happen in our virtual machine of azure.

![image](https://github.com/swopnilshakya7/Azure-Sentinel-SIEM-Mapping-Live-CyberAttacks/assets/140642619/e13ca9ee-9a31-456e-891f-03ce112ec578)



So to setup the geo map, Click on workbook> Add workbook
and then click on Edit

![image](https://github.com/swopnilshakya7/Azure-Sentinel-SIEM-Mapping-Live-CyberAttacks/assets/140642619/db2f596c-5bb1-4a7a-982f-072cbb088e26)


There will be default widgets shown in. We can remove it and then add new query based on our requirement of view. Just click of 3 dots of the widget and Remove them. Then add query.




![image](https://github.com/swopnilshakya7/Azure-Sentinel-SIEM-Mapping-Live-CyberAttacks/assets/140642619/64cf71f0-c83f-44e7-bc9f-460e7786d398)






















On the query part, paste the same query that we have created to distinguish the data during data extraction. And in the visualization part, choose Map.

![image](https://github.com/swopnilshakya7/Azure-Sentinel-SIEM-Mapping-Live-CyberAttacks/assets/140642619/131bb193-2575-4666-9860-c079ff961d32)


That green plot is my location from where I did try the login with wrong credentials.

You can always configure the map setting, specially lable to see the required data too that is present in the table.



![image](https://github.com/swopnilshakya7/Azure-Sentinel-SIEM-Mapping-Live-CyberAttacks/assets/140642619/861eb7a4-55dd-4acc-9ead-3f4292774e70)









































Now we can save the workbook as a name of mapping.

Now we can wait for days or weeks to collect a lot of data and enjoy watching the plots on the map.




![image](https://github.com/swopnilshakya7/Azure-Sentinel-SIEM-Mapping-Live-CyberAttacks/assets/140642619/8db5eb9c-9256-4cdd-a95a-cb872bd4629e)






The project is complete, we can always see the unauthorized login attempt access to our virtual machine and point out the location from where the attempt is done.


<ins>Step 14:<ins> Deleting resource group (Save your money :D) <br />

Now it's time to delete the resource group so there won’t be continuous charge going on which will end our free credit of $200 and azure will start charging via our credit card.

For that, just go to search box, type resource group and delete the created resource group in it.


![image](https://github.com/swopnilshakya7/Azure-Sentinel-SIEM-Mapping-Live-CyberAttacks/assets/140642619/1d0fc758-370a-4ec4-a85a-58a6c9b526e3)



It will show everything that is present in the resource group which is costing our credit per time. 

![image](https://github.com/swopnilshakya7/Azure-Sentinel-SIEM-Mapping-Live-CyberAttacks/assets/140642619/744775c4-304c-4c88-927e-3a5ab23486a0)



It will take some time and everything will get deleted. We can also cancel the subscription by going to all services and then subscription> select the subscription you want to cancel and then > cancel subscription.

![image](https://github.com/swopnilshakya7/Azure-Sentinel-SIEM-Mapping-Live-CyberAttacks/assets/140642619/d4fc0375-7175-4ff0-ac46-70bd17ba36ca)


<h3>Disclaimer</h3>
The content is completely for education purpose only. Any or full replication done to harm or unethical use may subjected to legal offense.




<!--
 ```diff
- text in red
+ text in green
! text in orange
# text in gray
@@ text in purple (and bold)@@
```
--!>
